<!DOCTYPE html>
<html lang="es">
<head>
<link rel="manifest" href="manifest.json">
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('service-worker.js');
    });
  }
</script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clasifica objetos por necesidades humanas ‚Äî 1¬∫ ESO</title>
  <!-- Tailwind desde CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Juego interactivo de arrastrar y soltar para clasificar objetos seg√∫n necesidades humanas: alimentaci√≥n, vivienda, trabajo, vestido, transporte, ocio y salud." />
  <style>
    .dragging { opacity: 0.7; transform: scale(0.98); }
    .drop-ok { outline: 2px dashed rgba(22,163,74,0.7); }
    .shake { animation: shake 300ms ease-in-out; }
    @keyframes shake { 0%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-3px)}100%{transform:translateX(0)} }
    .no-pointer { pointer-events: none !important; }
    .drag-shadow { box-shadow: 0 12px 24px rgba(0,0,0,.18); }
    .switch { --h:20px; position:relative; width:44px; height:var(--h); border-radius:9999px; background:#cbd5e1; transition:background .2s; }
    .switch[data-on="true"]{ background:#4f46e5; }
    .switch .knob{ position:absolute; top:2px; left:2px; width:16px; height:16px; border-radius:50%; background:#fff; transition:left .2s; }
    .switch[data-on="true"] .knob{ left:26px; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 text-slate-800">
  <header class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
        Clasifica objetos por <span class="text-indigo-600">necesidades humanas</span>
      </h1>

      <div class="flex flex-wrap items-center gap-3">
        <!-- Tiempo -->
        <div class="flex items-center gap-2 bg-white rounded-2xl shadow px-3 py-2">
          <label for="duration" class="text-xs text-slate-600 whitespace-nowrap">‚è±Ô∏è Tiempo</label>
          <input id="duration" type="number" min="10" max="120" step="5" class="w-16 rounded border border-slate-300 px-2 py-1 text-sm"
                 title="Duraci√≥n en segundos para nuevas partidas" />
          <span class="text-xs text-slate-500">s</span>
        </div>

        <!-- Sonido -->
        <div class="flex items-center gap-2 bg-white rounded-2xl shadow px-3 py-2">
          <span class="text-xs text-slate-600">Sonido</span>
          <button id="soundToggle" class="switch" type="button" aria-pressed="true" aria-label="Alternar sonido" data-on="true">
            <span class="knob"></span>
          </button>
        </div>

        <!-- Estado -->
        <div class="flex items-center gap-2 bg-white rounded-2xl shadow px-4 py-2">
          <span class="text-sm">‚è≥ Quedan</span>
          <span id="timer" class="text-xl font-bold tabular-nums">30</span>
        </div>
        <div class="flex items-center gap-2 bg-white rounded-2xl shadow px-4 py-2">
          <span class="text-sm">‚úÖ</span>
          <span id="hits" class="text-xl font-bold tabular-nums">0</span>
        </div>
        <div class="flex items-center gap-2 bg-white rounded-2xl shadow px-4 py-2">
          <span class="text-sm">‚ùå</span>
          <span id="misses" class="text-xl font-bold tabular-nums">0</span>
        </div>

        <button id="resetBtn" class="rounded-2xl bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 shadow focus:outline-none focus:ring-2 focus:ring-indigo-400">
          Nuevo juego
        </button>
      </div>
    </div>
    <p class="mt-2 text-sm text-slate-600 max-w-3xl">
      Arrastra cada tarjeta a la categor√≠a de necesidad que crees que satisface. Elige el tiempo (10‚Äì120 s) y usa el interruptor para activar o silenciar sonidos.
    </p>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-16">
    <section class="mb-6">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">Tabla de objetos (10 por partida)</h2>
      </div>
      <div id="pool" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
        <!-- Tarjetas generadas por JS -->
      </div>
    </section>

    <section>
      <div id="zones" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-2">
        <!-- Zonas generadas por JS -->
      </div>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 right-4 pointer-events-none hidden"></div>

  <!-- Modal fin de partida -->
  <div id="endModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 text-center">
      <h3 class="text-xl font-bold mb-2">Fin de la partida</h3>
      <p id="endText" class="text-slate-700 mb-4"></p>
      <button id="playAgain" class="rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2">Jugar de nuevo</button>
    </div>
  </div>

  <script>
    // ====== Motor de sonido (Web Audio, sin archivos externos) ======
    const Sound = {
      ctx: null, enabled: true,
      init() {
        if (!this.enabled) return;
        if (!this.ctx) {
          const AC = window.AudioContext || window.webkitAudioContext;
          if (!AC) { this.enabled = false; return; }
          this.ctx = new AC();
        }
        if (this.ctx.state === 'suspended') this.ctx.resume();
      },
      tone(freq=440, duration=0.12, type='sine', gain=0.06, when=0){
        if (!this.enabled || !this.ctx) return;
        const t0 = this.ctx.currentTime + when;
        const osc = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        osc.type = type; osc.frequency.value = freq;
        g.gain.value = gain;
        osc.connect(g); g.connect(this.ctx.destination);
        osc.start(t0); osc.stop(t0 + duration);
      },
      pattern(steps=[]){ let acc=0; for(const s of steps){ this.tone(s.f, s.d??0.12, s.type??'sine', s.g??0.06, acc); acc += (s.wait ?? s.d ?? 0.12);} },
      start(){ this.pattern([{f:523.25,d:0.09,g:0.07},{f:659.25,d:0.09,g:0.07},{f:783.99,d:0.12,g:0.07}]); },
      correct(){ this.pattern([{f:880.0,d:0.11,g:0.06,type:'triangle'}]); },
      wrong(){ this.pattern([{f:220.0,d:0.10,g:0.06,type:'square'},{f:185.0,d:0.10,g:0.06,type:'square'}]); },
      end(){ this.pattern([{f:392.0,d:0.35,g:0.06,type:'sine'}]); }
    };

    // ===== Persistencia sencilla =====
    const LS_KEYS = { sound: 'necesidades_sound', duration: 'necesidades_duration' };

    // ===== Categor√≠as =====
    const CATEGORIES = [
      { key: 'alimentaci√≥n', emoji: 'üçé', color: 'from-green-50 to-green-100 border-green-200' },
      { key: 'vivienda', emoji: 'üè†', color: 'from-amber-50 to-amber-100 border-amber-200' },
      { key: 'trabajo', emoji: 'üõ†Ô∏è', color: 'from-sky-50 to-sky-100 border-sky-200' },
      { key: 'vestido', emoji: 'üëï', color: 'from-fuchsia-50 to-fuchsia-100 border-fuchsia-200' },
      { key: 'transporte', emoji: 'üö≤', color: 'from-indigo-50 to-indigo-100 border-indigo-200' },
      { key: 'ocio', emoji: 'üéÆ', color: 'from-pink-50 to-pink-100 border-pink-200' },
      { key: 'salud', emoji: 'üè•', color: 'from-emerald-50 to-emerald-100 border-emerald-200' },
    ];

    // ===== Objetos (lista amplia para variedad) =====
    const ALL_ITEMS = [
      // Alimentaci√≥n
      ['pan','alimentaci√≥n'],['manzana','alimentaci√≥n'],['arroz','alimentaci√≥n'],['pasta','alimentaci√≥n'],['yogur','alimentaci√≥n'],
      ['queso','alimentaci√≥n'],['pescado enlatado','alimentaci√≥n'],['botella de agua','alimentaci√≥n'],['cazuela','alimentaci√≥n'],['cuchara','alimentaci√≥n'],
      ['microondas','alimentaci√≥n'],['nevera','alimentaci√≥n'],['sart√©n','alimentaci√≥n'],['plato','alimentaci√≥n'],
      // Vivienda
      ['casa de ladrillo','vivienda'],['caba√±a','vivienda'],['tienda de campa√±a','vivienda'],['calefactor','vivienda'],['ventana','vivienda'],
      ['techo','vivienda'],['colch√≥n','vivienda'],['silla','vivienda'],['mesa','vivienda'],['bombilla','vivienda'],
      ['ladrillos','vivienda'],['manta','vivienda'],['cortinas','vivienda'],['cerradura','vivienda'],
      // Trabajo
      ['martillo','trabajo'],['llave inglesa','trabajo'],['destornillador','trabajo'],['ordenador','trabajo'],['impresora','trabajo'],
      ['carretilla','trabajo'],['taladro','trabajo'],['cuaderno','trabajo'],['bol√≠grafo','trabajo'],['calculadora','trabajo'],
      ['bata de laboratorio','trabajo'],['casco de seguridad','trabajo'],['regla','trabajo'],['tijeras','trabajo'],
      // Vestido
      ['camiseta','vestido'],['pantalones','vestido'],['chaqueta','vestido'],['zapatos','vestido'],['sombrero','vestido'],
      ['guantes','vestido'],['bufanda','vestido'],['abrigo','vestido'],['gafas de sol','vestido'],['botas de lluvia','vestido'],
      ['uniforme escolar','vestido'],['calcetines','vestido'],['cintur√≥n','vestido'],['chanclas','vestido'],
      // Transporte
      ['bicicleta','transporte'],['coche','transporte'],['autob√∫s','transporte'],['tren','transporte'],['patinete','transporte'],
      ['monopat√≠n','transporte'],['barco','transporte'],['avi√≥n','transporte'],['moto','transporte'],['patines','transporte'],
      ['patinete el√©ctrico','transporte'],['telef√©rico','transporte'],['canoa','transporte'],
      // Ocio
      ['bal√≥n de f√∫tbol','ocio'],['libro de aventuras','ocio'],['videojuego','ocio'],['c√≥mic','ocio'],['baraja de cartas','ocio'],
      ['rompecabezas','ocio'],['pelota de baloncesto','ocio'],['guitarra','ocio'],['pel√≠cula en DVD','ocio'],['patio de juegos','ocio'],
      ['naipes','ocio'],['ajedrez','ocio'],['yo-yo','ocio'],
      // Salud
      ['term√≥metro','salud'],['botiqu√≠n','salud'],['vendaje','salud'],['mascarilla','salud'],['jab√≥n','salud'],
      ['cepillo de dientes','salud'],['vacuna','salud'],['gafas','salud'],['silla de ruedas','salud'],['agua oxigenada','salud'],
      ['casco de bici','salud'],['muletas','salud'],['gel hidroalcoh√≥lico','salud']
    ];

    // ===== Estado =====
    const state = {
      itemsInPlay: [], hits: 0, misses: 0, placed: 0,
      timeLeft: 30, timeUp: false,
      draggingEl: null, // escritorio
      mobileDragging: null // t√°ctil
    };

    // ===== Utilidades =====
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);

    function shuffle(arr){
      const a = [...arr];
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }
    function sampleItems(n=10){
      return shuffle(ALL_ITEMS).slice(0,n).map(([name,cat])=>({name,cat}));
    }

    function el(tag, cls, attrs={}){
      const e = document.createElement(tag);
      if(cls) e.className = cls;
      for(const [k,v] of Object.entries(attrs)){
        if(k==='text') e.textContent = v;
        else e.setAttribute(k,v);
      }
      return e;
    }

    function showToast(msg, kind='info'){
      const t = $('#toast');
      const base = 'rounded-2xl shadow-lg px-4 py-3 mb-2 text-sm font-medium transition-opacity';
      const color = kind==='ok' ? 'bg-emerald-600 text-white'
                  : kind==='bad' ? 'bg-rose-600 text-white'
                  : 'bg-slate-800 text-white';
      const box = el('div', base+' '+color, { text: msg });
      t.appendChild(box);
      t.classList.remove('hidden');
      setTimeout(()=>{
        box.classList.add('opacity-0');
        box.addEventListener('transitionend',()=>box.remove(),{once:true});
      }, 1200);
    }

    function updateScore(){
      $('#hits').textContent = state.hits;
      $('#misses').textContent = state.misses;
    }

    function endGame(reason='time'){
      state.timeUp = true;
      $$('#pool [draggable="true"]').forEach(el=>el.setAttribute('draggable','false'));
      $$('.dropzone').forEach(z=>z.classList.add('opacity-60','no-pointer'));
      $('#timer').classList.add('text-rose-600');

      cancelMobileDrag(true);

      const msg = reason==='win'
        ? `¬°Enhorabuena! Clasificaste las 10 tarjetas con ${state.misses} ${state.misses===1?'fallo':'fallos'}.`
        : `Tiempo agotado. Aciertos: ${state.hits}. Fallos: ${state.misses}.`;
      $('#endText').textContent = msg;
      $('#endModal').classList.remove('hidden');

      if (Sound.ctx && Sound.ctx.state === 'running') Sound.end();
    }

    // ===== Render =====
    function renderZones(){
      const zones = $('#zones');
      zones.innerHTML = '';
      for(const c of CATEGORIES){
        const zone = el('div', `dropzone border ${c.color} bg-gradient-to-b rounded-2xl p-4 min-h-[120px] flex flex-col gap-3`);
        zone.dataset.category = c.key;
        const hdr = el('div','flex items-center gap-2');
        hdr.append(el('span','text-xl',{text:c.emoji}), el('h3','font-semibold',{text:c.key}));
        const area = el('div','grow grid grid-cols-2 sm:grid-cols-3 gap-2');
        zone.append(hdr, area);
        zones.appendChild(zone);
      }
    }

    function renderPool(){
      const pool = $('#pool');
      pool.innerHTML = '';
      state.itemsInPlay.forEach((item)=>{
        const card = el('button','item-card group bg-white rounded-2xl border border-slate-200 shadow hover:shadow-md px-3 py-2 text-left focus:outline-none focus:ring-2 focus:ring-indigo-400',{
          draggable:'true', 'data-name': item.name, 'data-cat': item.cat, type:'button',
          'aria-label': `Objeto: ${item.name}`
        });
        const title = el('div','font-semibold text-slate-800 text-sm',{text:item.name});
        card.append(title);

        addDragHandlersDesktop(card); // rat√≥n
        addDragHandlersTouch(card);   // t√°ctil

        pool.appendChild(card);
      });
    }

    // ====== DnD escritorio ======
    function addDragHandlersDesktop(elm){
      elm.addEventListener('dragstart',(e)=>{
        if(state.timeUp){ e.preventDefault(); return; }
        state.draggingEl = elm;
        e.dataTransfer.setData('text/plain', JSON.stringify({ name: elm.dataset.name, cat: elm.dataset.cat }));
        e.dataTransfer.effectAllowed = 'move';
        elm.classList.add('dragging');
      });
      elm.addEventListener('dragend',()=>{
        elm.classList.remove('dragging');
        state.draggingEl = null;
      });
    }
    function addZoneHandlersDesktop(){
      $$('.dropzone').forEach(zone=>{
        zone.addEventListener('dragover',(e)=>{
          if(state.timeUp) return;
          e.preventDefault();
          zone.classList.add('drop-ok');
        });
        zone.addEventListener('dragleave',()=> zone.classList.remove('drop-ok'));
        zone.addEventListener('drop',(e)=>{
          e.preventDefault();
          zone.classList.remove('drop-ok');
          const payload = e.dataTransfer.getData('text/plain');
          if(!payload) return;
          const data = JSON.parse(payload);
          handleDrop(data, zone, state.draggingEl);
        });
      });
    }

    // ====== Arrastre t√°ctil ======
    function addDragHandlersTouch(card){
      card.addEventListener('pointerdown', (ev)=>{
        if(state.timeUp) return;
        if(ev.pointerType !== 'touch' && ev.pointerType !== 'pen') return;
        ev.preventDefault();
        startMobileDrag(card, ev.clientX, ev.clientY);
        card.setPointerCapture(ev.pointerId);

        const move = (e)=> { moveMobileDrag(e.clientX, e.clientY); };
        const up = (e)=> {
          finishMobileDrag(e.clientX, e.clientY);
          card.releasePointerCapture(ev.pointerId);
          window.removeEventListener('pointermove', move);
          window.removeEventListener('pointerup', up);
          window.removeEventListener('pointercancel', cancel);
        };
        const cancel = ()=> { cancelMobileDrag(true); };

        window.addEventListener('pointermove', move, { passive: false });
        window.addEventListener('pointerup', up, { passive: false });
        window.addEventListener('pointercancel', cancel, { passive: false });
      }, { passive: false });
    }

    function startMobileDrag(card, x, y){
      const rect = card.getBoundingClientRect();
      state.mobileDragging = {
        card,
        startParent: card.parentElement,
        offsetX: x - rect.left,
        offsetY: y - rect.top,
        width: rect.width,
        height: rect.height
      };
      card.style.position = 'fixed';
      card.style.left = (x - state.mobileDragging.offsetX) + 'px';
      card.style.top = (y - state.mobileDragging.offsetY) + 'px';
      card.style.width = rect.width + 'px';
      card.style.height = rect.height + 'px';
      card.style.zIndex = '1000';
      card.classList.add('dragging','drag-shadow');
      document.body.appendChild(card);
    }

    function moveMobileDrag(x, y){
      const d = state.mobileDragging;
      if(!d) return;
      window.getSelection()?.removeAllRanges?.();
      d.card.style.left = (x - d.offsetX) + 'px';
      d.card.style.top = (y - d.offsetY) + 'px';
    }

    function finishMobileDrag(x, y){
      const d = state.mobileDragging;
      if(!d) return;
      const target = document.elementFromPoint(x, y);
      const zone = target && target.closest?.('.dropzone');

      d.card.classList.remove('drag-shadow');
      d.card.style.position = '';
      d.card.style.left = '';
      d.card.style.top = '';
      d.card.style.width = '';
      d.card.style.height = '';
      d.card.style.zIndex = '';

      if(state.timeUp){
        d.startParent.appendChild(d.card);
        d.card.classList.remove('dragging');
        state.mobileDragging = null;
        return;
      }
      if(zone){
        const data = { name: d.card.dataset.name, cat: d.card.dataset.cat };
        handleDrop(data, zone, d.card, true);
      } else {
        d.startParent.appendChild(d.card);
      }
      d.card.classList.remove('dragging');
      state.mobileDragging = null;
    }

    function cancelMobileDrag(returnToPool){
      const d = state.mobileDragging;
      if(!d) return;
      d.card.classList.remove('dragging','drag-shadow');
      d.card.style.position = '';
      d.card.style.left = '';
      d.card.style.top = '';
      d.card.style.width = '';
      d.card.style.height = '';
      d.card.style.zIndex = '';
      if(returnToPool) d.startParent.appendChild(d.card);
      state.mobileDragging = null;
    }

    // ===== L√≥gica com√∫n al soltar =====
    function handleDrop(data, zone, draggedCard){
      if(state.timeUp){
        if(draggedCard) $('#pool').appendChild(draggedCard);
        return;
      }
      const isCorrect = data.cat === zone.dataset.category;
      if(isCorrect){
        const area = zone.querySelector('.grid');
        const card = draggedCard;
        card.setAttribute('draggable','false');
        card.classList.add('ring-2','ring-emerald-400');
        area.appendChild(card);
        state.hits++; state.placed++; updateScore();
        showToast('¬°Correcto! ‚úÖ','ok');
        if (Sound.ctx && Sound.ctx.state === 'running' && Sound.enabled) Sound.correct();
        if(state.placed === state.itemsInPlay.length){
          endGame('win');
        }
      } else {
        showToast('No exactamente. Int√©ntalo de nuevo.','bad');
        state.misses++; updateScore();
        if(draggedCard){
          draggedCard.classList.add('shake');
          setTimeout(()=>{ draggedCard.classList.remove('shake'); $('#pool').appendChild(draggedCard); }, 180);
        }
        if (Sound.ctx && Sound.ctx.state === 'running' && Sound.enabled) Sound.wrong();
      }
    }

    // ===== Temporizador =====
    let timerInterval = null;
    function startTimer(){
      $('#timer').textContent = state.timeLeft;
      timerInterval = setInterval(()=>{
        state.timeLeft--;
        $('#timer').textContent = state.timeLeft;
        if(state.timeLeft <= 5) $('#timer').classList.add('animate-pulse','text-amber-600');
        if(state.timeLeft <= 0){
          clearInterval(timerInterval);
          $('#timer').textContent = '0';
          endGame('time');
        }
      }, 1000);
    }

    // ===== Inicio / Reinicio =====
    function newGame({silent=false} = {}){
      state.itemsInPlay = sampleItems(10);
      state.hits = 0; state.misses = 0; state.placed = 0;
      state.timeLeft = getSelectedDuration(); state.timeUp = false; state.draggingEl = null;
      cancelMobileDrag(true);

      updateScore();
      $('#timer').className = 'text-xl font-bold tabular-nums';
      $('#toast').innerHTML = ''; $('#toast').classList.add('hidden');
      $('#endModal').classList.add('hidden');

      renderZones();
      renderPool();
      addZoneHandlersDesktop();
      $$('.dropzone').forEach(z=>z.classList.remove('opacity-60','no-pointer'));

      if(timerInterval) clearInterval(timerInterval);
      startTimer();

      showToast('¬°Nueva partida iniciada!','ok');
      if (!silent && Sound.ctx && Sound.ctx.state === 'running' && Sound.enabled) {
        Sound.start();
      }
    }

    // ===== UI: duraci√≥n y sonido =====
    function getSelectedDuration(){
      const v = parseInt($('#duration').value, 10);
      if (isNaN(v)) return 30;
      return Math.max(10, Math.min(120, v));
    }
    function setSelectedDuration(v){
      $('#duration').value = v;
      localStorage.setItem(LS_KEYS.duration, String(v));
    }
    function applySavedPrefs(){
      const d = parseInt(localStorage.getItem(LS_KEYS.duration) ?? '30', 10);
      setSelectedDuration(isNaN(d)?30:d);

      const soundSaved = localStorage.getItem(LS_KEYS.sound);
      const on = soundSaved === null ? true : soundSaved === 'true';
      Sound.enabled = on;
      const btn = $('#soundToggle');
      btn.dataset.on = String(on);
      btn.setAttribute('aria-pressed', String(on));
      $('#timer').textContent = getSelectedDuration();
    }

    // Eventos UI
    $('#duration').addEventListener('change', ()=>{
      const v = getSelectedDuration();
      setSelectedDuration(v);
      // No cambia la partida en curso; se aplica al pr√≥ximo "Nuevo juego"
      showToast(`Tiempo para nuevas partidas: ${v}s`, 'ok');
    });
    $('#soundToggle').addEventListener('click', (e)=>{
      const btn = e.currentTarget;
      const on = !(btn.dataset.on === 'true');
      btn.dataset.on = String(on);
      btn.setAttribute('aria-pressed', String(on));
      Sound.enabled = on;
      localStorage.setItem(LS_KEYS.sound, String(on));
      showToast(on ? 'Sonido activado' : 'Sonido desactivado', on ? 'ok' : 'bad');
      if (on) Sound.init(); // prepara audio tras interacci√≥n
    });

    // Botones
    $('#resetBtn').addEventListener('click', ()=>{
      if (Sound.enabled) Sound.init(); // activa audio tras interacci√≥n
      newGame({silent: !Sound.enabled});
    });
    $('#playAgain').addEventListener('click', ()=>{
      if (Sound.enabled) Sound.init();
      newGame({silent: !Sound.enabled});
    });

    // Al cargar
    window.addEventListener('DOMContentLoaded', ()=>{
      applySavedPrefs();
      // Partida inicial SIN sonido (audio solo tras primer clic, por pol√≠ticas de autoplay)
      newGame({silent:true});
    });
  </script>
</body>
</html>
